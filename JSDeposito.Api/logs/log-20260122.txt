2026-01-22 21:03:19.505 -03:00 [INF] Listando produtos ativos
2026-01-22 21:03:19.593 -03:00 [INF] Tentativa de refresh token
2026-01-22 21:03:19.742 -03:00 [INF] Refresh token válido | UsuarioId: 6
2026-01-22 21:03:19.752 -03:00 [INF] Listando produtos ativos
2026-01-22 21:03:19.991 -03:00 [INF] Novos tokens emitidos | UsuarioId: 6
2026-01-22 21:04:09.450 -03:00 [INF] Adicionando item | PedidoId: 107 | ProdutoId: 1
2026-01-22 21:04:09.501 -03:00 [INF] Item adicionado | PedidoId: 107 | ProdutoId: 1
2026-01-22 21:04:26.418 -03:00 [INF] Limpando itens do pedido 107
2026-01-22 21:04:26.496 -03:00 [INF] Listando produtos ativos
2026-01-22 21:04:26.515 -03:00 [INF] Listando produtos ativos
2026-01-22 21:04:34.394 -03:00 [INF] Adicionando item | PedidoId: 107 | ProdutoId: 1
2026-01-22 21:04:34.404 -03:00 [INF] Item adicionado | PedidoId: 107 | ProdutoId: 1
2026-01-22 21:04:38.556 -03:00 [INF] Adicionando item | PedidoId: 107 | ProdutoId: 8
2026-01-22 21:04:38.567 -03:00 [INF] Item adicionado | PedidoId: 107 | ProdutoId: 8
2026-01-22 21:04:47.190 -03:00 [INF] Listando produtos ativos
2026-01-22 21:04:47.216 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/107 | Method: GET
JSDeposito.Core.Exceptions.BusinessException: Você não tem permissão para acessar este pedido
   at JSDeposito.Core.Services.PedidoService.ValidarAcessoAoPedido(Int32 pedidoId, Nullable`1 usuarioId, Nullable`1 tokenAnonimo) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 421
   at JSDeposito.Api.Controllers.PedidoController.Obter(Int32 pedidoId) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 69
   at lambda_method11(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:04:47.259 -03:00 [INF] Listando produtos ativos
2026-01-22 21:04:47.474 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/107 | Method: GET
JSDeposito.Core.Exceptions.BusinessException: Você não tem permissão para acessar este pedido
   at JSDeposito.Core.Services.PedidoService.ValidarAcessoAoPedido(Int32 pedidoId, Nullable`1 usuarioId, Nullable`1 tokenAnonimo) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 421
   at JSDeposito.Api.Controllers.PedidoController.Obter(Int32 pedidoId) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 69
   at lambda_method11(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:04:47.509 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/107 | Method: GET
JSDeposito.Core.Exceptions.BusinessException: Você não tem permissão para acessar este pedido
   at JSDeposito.Core.Services.PedidoService.ValidarAcessoAoPedido(Int32 pedidoId, Nullable`1 usuarioId, Nullable`1 tokenAnonimo) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 421
   at JSDeposito.Api.Controllers.PedidoController.Obter(Int32 pedidoId) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 69
   at lambda_method11(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:04:47.528 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/107 | Method: GET
JSDeposito.Core.Exceptions.BusinessException: Você não tem permissão para acessar este pedido
   at JSDeposito.Core.Services.PedidoService.ValidarAcessoAoPedido(Int32 pedidoId, Nullable`1 usuarioId, Nullable`1 tokenAnonimo) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 421
   at JSDeposito.Api.Controllers.PedidoController.Obter(Int32 pedidoId) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 69
   at lambda_method11(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:04:50.836 -03:00 [INF] Criando pedido anônimo
2026-01-22 21:04:50.844 -03:00 [INF] Pedido anônimo criado | PedidoId: 114
2026-01-22 21:04:50.868 -03:00 [INF] Adicionando item | PedidoId: 114 | ProdutoId: 7
2026-01-22 21:04:50.878 -03:00 [INF] Item adicionado | PedidoId: 114 | ProdutoId: 7
2026-01-22 21:05:06.878 -03:00 [INF] Listando produtos ativos
2026-01-22 21:05:06.924 -03:00 [INF] Listando produtos ativos
2026-01-22 21:05:10.788 -03:00 [INF] Listando produtos ativos
2026-01-22 21:05:10.803 -03:00 [INF] Listando produtos ativos
2026-01-22 21:05:32.425 -03:00 [ERR] Failed executing DbCommand (17ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
DELETE FROM `Pedidos`
WHERE `Id` = @p0;
SELECT ROW_COUNT();
2026-01-22 21:05:32.503 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'JSDeposito.Api.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2026-01-22 21:05:32.533 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/descartar-anonimo | Method: POST
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges()
   at JSDeposito.Api.Data.PedidoRepository.Remover(Pedido pedido) in D:\Desenvolvimento\backend\JSDeposito.Api\Data\PedidoRepository.cs:line 46
   at JSDeposito.Api.Controllers.PedidoController.DescartarAnonimo() in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 258
   at lambda_method376(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:05:32.568 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/descartar-anonimo | Method: POST
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges()
   at JSDeposito.Api.Data.PedidoRepository.Remover(Pedido pedido) in D:\Desenvolvimento\backend\JSDeposito.Api\Data\PedidoRepository.cs:line 46
   at JSDeposito.Api.Controllers.PedidoController.DescartarAnonimo() in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 258
   at lambda_method376(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:05:53.276 -03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
DELETE FROM `Pedidos`
WHERE `Id` = @p0;
SELECT ROW_COUNT();
2026-01-22 21:05:53.280 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'JSDeposito.Api.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2026-01-22 21:05:53.309 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/descartar-anonimo | Method: POST
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges()
   at JSDeposito.Api.Data.PedidoRepository.Remover(Pedido pedido) in D:\Desenvolvimento\backend\JSDeposito.Api\Data\PedidoRepository.cs:line 46
   at JSDeposito.Api.Controllers.PedidoController.DescartarAnonimo() in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 258
   at lambda_method376(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:05:53.363 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/descartar-anonimo | Method: POST
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot delete or update a parent row: a foreign key constraint fails (`jsdeposito`.`itenspedido`, CONSTRAINT `FK_ItensPedido_Pedidos_PedidoId` FOREIGN KEY (`PedidoId`) REFERENCES `pedidos` (`Id`))
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChanges(IList`1 entries)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.<>c.<SaveChanges>b__112_0(DbContext _, ValueTuple`2 t)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges()
   at JSDeposito.Api.Data.PedidoRepository.Remover(Pedido pedido) in D:\Desenvolvimento\backend\JSDeposito.Api\Data\PedidoRepository.cs:line 46
   at JSDeposito.Api.Controllers.PedidoController.DescartarAnonimo() in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 258
   at lambda_method376(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:06:18.885 -03:00 [INF] Listando produtos ativos
2026-01-22 21:06:18.892 -03:00 [INF] Listando produtos ativos
2026-01-22 21:06:47.712 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 7
2026-01-22 21:06:47.723 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 7
2026-01-22 21:06:47.989 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 6
2026-01-22 21:06:47.998 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 6
2026-01-22 21:10:47.430 -03:00 [INF] Limpando itens do pedido 108
2026-01-22 21:10:47.570 -03:00 [INF] Listando produtos ativos
2026-01-22 21:10:47.612 -03:00 [INF] Listando produtos ativos
2026-01-22 21:10:49.872 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 5
2026-01-22 21:10:49.882 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 5
2026-01-22 21:10:50.819 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 6
2026-01-22 21:10:50.891 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 6
2026-01-22 21:10:51.952 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 1
2026-01-22 21:10:51.962 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 1
2026-01-22 21:10:52.593 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:10:52.672 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:10:54.905 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:10:54.924 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:10:55.106 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:10:55.126 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.316 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.335 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.563 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.581 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.726 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:00.746 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.272 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.287 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.442 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.457 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.631 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:01.653 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/5 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:11:02.846 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 7
2026-01-22 21:11:02.872 -03:00 [INF] Item adicionado | PedidoId: 108 | ProdutoId: 7
2026-01-22 21:11:25.285 -03:00 [INF] Aplicando frete | PedidoId: 108 | EnderecoId: 2 | UsuarioId: 6
2026-01-22 21:11:25.289 -03:00 [INF] Calculando frete | Origem: (-10.908214,-37.083165) | Destino: (-10.9093786,-37.0845893)
2026-01-22 21:11:25.313 -03:00 [INF] Frete calculado | Distância: 0.2 km | Valor: 5
2026-01-22 21:11:25.346 -03:00 [INF] Frete aplicado | PedidoId: 108 | Valor: 5
2026-01-22 21:11:39.814 -03:00 [INF] Finalizando pedido | PedidoId: 108 | UsuarioId: 6
2026-01-22 21:11:39.822 -03:00 [INF] Pedido validado para pagamento | PedidoId: 108
2026-01-22 21:11:50.789 -03:00 [INF] Listando produtos ativos
2026-01-22 21:11:50.796 -03:00 [INF] Listando produtos ativos
2026-01-22 21:16:32.582 -03:00 [INF] Listando produtos ativos
2026-01-22 21:16:32.621 -03:00 [INF] Listando produtos ativos
2026-01-22 21:17:49.113 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 4
2026-01-22 21:17:49.153 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Estoque atual: 0
   at JSDeposito.Core.Services.PedidoService.AdicionarItem(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 161
   at JSDeposito.Api.Controllers.PedidoController.Adicionar(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 91
   at lambda_method326(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:17:49.174 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Estoque atual: 0
   at JSDeposito.Core.Services.PedidoService.AdicionarItem(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 161
   at JSDeposito.Api.Controllers.PedidoController.Adicionar(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 91
   at lambda_method326(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:17:49.912 -03:00 [INF] Adicionando item | PedidoId: 108 | ProdutoId: 4
2026-01-22 21:17:49.919 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Estoque atual: 0
   at JSDeposito.Core.Services.PedidoService.AdicionarItem(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 161
   at JSDeposito.Api.Controllers.PedidoController.Adicionar(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 91
   at lambda_method326(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:17:49.937 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Estoque atual: 0
   at JSDeposito.Core.Services.PedidoService.AdicionarItem(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 161
   at JSDeposito.Api.Controllers.PedidoController.Adicionar(Int32 pedidoId, AdicionarItemPedidoDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 91
   at lambda_method326(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:06.595 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/1 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:06.611 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/1 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:07.292 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/1 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:07.358 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/itens/1 | Method: PUT
System.NullReferenceException: Object reference not set to an instance of an object.
   at JSDeposito.Core.Services.PedidoService.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, Int32 quantidade) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 247
   at JSDeposito.Api.Controllers.PedidoController.AlterarQuantidade(Int32 pedidoId, Int32 produtoId, AlterarQuantidadeDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 119
   at lambda_method378(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:13.333 -03:00 [INF] Aplicando cupom d no pedido 108
2026-01-22 21:21:13.344 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/cupom | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Cupom inválido
   at JSDeposito.Core.Services.PedidoService.AplicarCupom(Int32 pedidoId, String codigoCupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 290
   at JSDeposito.Api.Controllers.PedidoController.AplicarCupom(Int32 pedidoId, AplicarCupomDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 154
   at lambda_method540(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:13.359 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/cupom | Method: POST
JSDeposito.Core.Exceptions.BusinessException: Cupom inválido
   at JSDeposito.Core.Services.PedidoService.AplicarCupom(Int32 pedidoId, String codigoCupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 290
   at JSDeposito.Api.Controllers.PedidoController.AplicarCupom(Int32 pedidoId, AplicarCupomDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 154
   at lambda_method540(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:19.314 -03:00 [INF] Aplicando cupom desc20 no pedido 108
2026-01-22 21:21:19.332 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/cupom | Method: POST
System.Exception: Cupom expirado
   at JSDeposito.Core.Entities.Cupom.Validar() in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Cupom.cs:line 43
   at JSDeposito.Core.Entities.Cupom.CalcularDesconto(Decimal totalPedido) in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Cupom.cs:line 51
   at JSDeposito.Core.Entities.Pedido.AplicarCupom(Cupom cupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Pedido.cs:line 72
   at JSDeposito.Core.Services.PedidoService.AplicarCupom(Int32 pedidoId, String codigoCupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 293
   at JSDeposito.Api.Controllers.PedidoController.AplicarCupom(Int32 pedidoId, AplicarCupomDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 154
   at lambda_method540(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:21:19.357 -03:00 [ERR] Erro não tratado | Path: /api/pedidos/108/cupom | Method: POST
System.Exception: Cupom expirado
   at JSDeposito.Core.Entities.Cupom.Validar() in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Cupom.cs:line 43
   at JSDeposito.Core.Entities.Cupom.CalcularDesconto(Decimal totalPedido) in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Cupom.cs:line 51
   at JSDeposito.Core.Entities.Pedido.AplicarCupom(Cupom cupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Entities\Pedido.cs:line 72
   at JSDeposito.Core.Services.PedidoService.AplicarCupom(Int32 pedidoId, String codigoCupom) in D:\Desenvolvimento\backend\JSDeposito.Core\Services\PedidoService.cs:line 293
   at JSDeposito.Api.Controllers.PedidoController.AplicarCupom(Int32 pedidoId, AplicarCupomDto dto) in D:\Desenvolvimento\backend\JSDeposito.Api\Controllers\PedidoController.cs:line 154
   at lambda_method540(Closure, Object, Object[])
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at JSDeposito.Api.Middlewares.GlobalExceptionMiddleware.InvokeAsync(HttpContext context) in D:\Desenvolvimento\backend\JSDeposito.Api\Middlewares\GlobalExceptionMiddleware.cs:line 25
2026-01-22 21:22:19.850 -03:00 [INF] Aplicando frete | PedidoId: 108 | EnderecoId: 2 | UsuarioId: 6
2026-01-22 21:22:19.859 -03:00 [INF] Calculando frete | Origem: (-10.908214,-37.083165) | Destino: (-10.9093786,-37.0845893)
2026-01-22 21:22:19.873 -03:00 [INF] Frete calculado | Distância: 0.2 km | Valor: 5
2026-01-22 21:22:19.878 -03:00 [INF] Frete aplicado | PedidoId: 108 | Valor: 5
